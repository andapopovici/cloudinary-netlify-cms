<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Netlify CMS</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js" type="text/javascript"></script>
  </head>
  <body>
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js" type="text/javascript"></script>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/dayjs@^1.7.5/dayjs.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="previews.js" type="text/babel"></script>
    <script src="https://media-library.cloudinary.com/global/all.js"></script> 
    <script type="text/javascript">
      CMS.registerPreviewStyle('/stylesheets/all.css');
      CMS.registerMediaLibrary(cloudinary);

      fetch("/.netlify/functions/hello")
      .then(res => res.json())
      .then(function(response) {
        console.log("RESPONSE")
        console.log(response)

        window.ml = cloudinary.createMediaLibrary({
          cloud_name: 'drzfqrj57',
          api_key: '898113495945594',
          username: 'website@freeagent.com',
          timestamp: response.timestamp,
          signature: response.signature,
          button_class: 'cloudinary-button',
          button_caption: 'Select Image or Video',
        })
      });

      document.getElementById("cloud-button").addEventListener("click", function(){
                 window.ml.open();
             }, false);
    </script>

    <button id="cloud-button" class="cloudinary-button">Upload files</button>  
  </body>
</html>
